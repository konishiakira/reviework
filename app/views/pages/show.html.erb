<%= render "shared/header" %>
<div class='main'>
  <div class='top'>
    <div class='title-text'><%= "#{@page.title}　レビュページ" %></div>
    <div class='title-text'><%= "レビュアーの：#{@page.title}のイメージ：　#{@page.title}　" %></div>

    <%= @like_count = Cr.where(page_id: params[:id]).count %>

  </div>




  <div class='review-center'>
    <div class='review-push'>
      レビュー投稿（review-push）


      <%# ログインしていないと表示しない %>
      <% if user_signed_in? %>

      <div class='review-push-in'>
        レビュー投稿フォーム（review-push-in）


        <%# もし、ログインユーザーのレビュー投稿が存在しなければ表示（replの値の有無がレビューとリプライの判定） %>
        <% if @mach_id == nil %>
            <%= form_for @review do |f| %>
              <%= f.hidden_field :page_id, value: @page.id %>
              <%= f.text_field :comment, class: "text-field" %>
              <%= f.submit '投稿', class: "submit-btn" %>
            <% end %>
        <% end %>
      </div>

        <% @reviews.each do |b| %>
          <% if current_user.id == b.user_id && b.repl == nil %>
            <div class='review-ii-in'>
              <div class='review-ii-in'>
                <%= b.user.name %>
                <%= b.comment %>
                <%= b.updated_at.strftime("%Y-%m-%d %H:%M:%S") %>

                <%# ここにユーザーのレビュー投稿を削除する記述をする %>
                <%= link_to '削除', page_path(@des_id.page_id), method: :delete %>
              <%# //ここにユーザーのレビュー投稿を削除する記述をする %>
              </div>

              <div class='review-ii-in'>
                <%# 泣アイコンの選択 %>
                <div class="buttons_<%= @food.id %>"><%= render partial: 'crs/cr' %></div>
                <%# ここに表示しているいいね機能を正常にカウントさせ、保持し、アップデートビューにてレビュー投稿表示側に値を表示させる %>
                <%#// 泣アイコンの選択 %>

                <%# かっこいいアイコンの選択 %>
                <div class="buttons_<%= @cool.id %>"><%= render partial: 'cools/cool' %></div>
                <%# ここに表示しているいいね機能を正常にカウントさせ、保持し、アップデートビューにてレビュー投稿表示側に値を表示させる %>
                <%#// かっこいいアイコンの選択 %>

                <%# 可愛いアイコンの選択 %>
                <div class="buttons_<%= @cute.id %>"><%= render partial: 'cutes/cute' %></div>
                <%# ここに表示しているいいね機能を正常にカウントさせ、保持し、アップデートビューにてレビュー投稿表示側に値を表示させる %>
                <%#// 可愛いアイコンの選択 %>


                <%# 怖いアイコンの選択 %>
                <div class="buttons_<%= @scared.id %>"><%= render partial: 'scareds/scared' %></div>
                <%# ここに表示しているいいね機能を正常にカウントさせ、保持し、アップデートビューにてレビュー投稿表示側に値を表示させる %>
                <%#// 怖いアイコンの選択 %>



              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
      <%# //ログインしていないと表示しない %>


    </div>
    <div class='review-data'>
      本作品のレビュー内容（review-data）
      <div class='review-data-in'>
        <%# <div class='review-data-user'> %>
          <% @reviews.each_with_index do |r,i| %>
            <p class='comment'>
 
              <%# リプ用カラムに値が無ければ表示（レビューと判断する） %>
              <% if r.repl == nil %>
                <%= r.user.name %>
                <%= r.comment %>
                <%= r.updated_at.strftime("%Y-%m-%d %H:%M:%S") %>
                テスト

                <% if user_signed_in? %>
                  <% if current_user.id != r.user_id %>
                    <%= link_to "返信", page_path(r.page.id, id: r.id), method: :put %>
                  <% end %>
                <% end %>
            <%#= form_for @repl do |f| %>
              <%#= f.hidden_field :id, value: @repls.id %>
              <%#= f.hidden_field :page_id, value: @page.id %>
              <%#= f.submit '返信', class: "submit-btn" %>
            <%# end %>


              <%# users_path(group_id: 1, team_id: 2) %>
              
              <%# <th class="detail-item">出品者</th>
              <td class="detail-value"><%= @items.user.nickname %>

              <% end %>
          

             <%# レビュー投稿(r.id)とレビュー投稿(r.repl)が等しくて
             ログインユーザーidとレビュー投稿id（@reviews[1].user_id）が等しい時、
             投稿フォームを出さない。 %>

              <%# リプ用カラムに値が有れば表示（リプライと判断する） %>
              <% @reviews.each do |b| %>
                <% if b.repl != nil %>
                  <p class='comment'>
                  <% if b.repl == r.id %>
                      <%= b.user.name %>
                      <%= b.comment %>
                      <%= b.updated_at.strftime("%Y-%m-%d %H:%M:%S") %>
                  <% end %>
                <% end %>
              <% end %>


            </p>
          <% end %>

      </div>
    </div>



  </div>
</div>
<%= render "shared/footer" %>